<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trip Planner</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI Trip Planner</h1>
            <p class="subtitle">
                Your ultimate AI-powered travel companion: crafting personalized routes, hotels, activities, and more with precision and flair.
            </p>
        </div>

        <div class="chat-container" id="chat-container">
            <div class="message ai">
                <div class="message-header">AI Trip Assistant</div>
                <div class="message-content">
                    üåç Welcome to your AI Trip Planner! I'm here to help you create amazing travel experiences. Tell me where you'd like to go, your budget, interests, or any specific requirements, and I'll craft a personalized itinerary just for you!
                </div>
            </div>
        </div>

        <div class="input-section">
            <div class="input-container">
                <div class="textarea-wrapper">
                    <button class="attachment-button" title="Attach file">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 6v12M6 12h12"/>
                        </svg>
                    </button>
                    <textarea 
                        id="user-input" 
                        placeholder="Tell me your travel dreams..."
                        rows="1"
                    ></textarea>
                </div>
                <button class="send-button" id="send-button" onclick="sendMessage()" title="Send message">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2 11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        
        // API Configuration - Replace with your backend URL
        const API_BASE_URL = 'http://localhost:8000'; // Change this to your backend URL

        function autoResize(element) {
            element.style.height = 'auto';
            element.style.height = Math.min(element.scrollHeight, 300) + 'px';
        }

        userInput.addEventListener('input', function() {
            autoResize(this);
            updateButtonState();
        });

        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        function updateButtonState() {
            const hasText = userInput.value.trim().length > 0;
            sendButton.style.opacity = hasText ? '1' : '0.4';
        }

        function addMessage(sender, content, type = 'user') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            if (type === 'loading') {
                messageDiv.innerHTML = `
                    <div class="message-header">AI Trip Assistant</div>
                    <div class="message-content">
                        <div class="loading-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                `;
            } else {
                const header = type === 'ai' ? 'AI Trip Assistant' : 'You';
                const processedContent = type === 'ai' ? marked.parse(content) : content;
                
                messageDiv.innerHTML = `
                    <div class="message-header">${header}</div>
                    <div class="message-content">${processedContent}</div>
                `;
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return messageDiv;
        }

        function disableInput(disabled) {
            userInput.disabled = disabled;
            sendButton.disabled = disabled;
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage('You', message, 'user');
            
            // Clear input and disable controls
            userInput.value = '';
            autoResize(userInput);
            disableInput(true);
            
            // Add loading message
            const loadingMessage = addMessage('', '', 'loading');

            try {
                // Make API call to your backend
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        message: `You are a helpful AI travel assistant. Help plan trips, suggest destinations, activities, hotels, and provide travel advice. User query: ${message}` 
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Remove loading message
                chatContainer.removeChild(loadingMessage);
                
                // Add AI response
                addMessage('AI', data.reply || data.response || 'I apologize, but I encountered an issue. Please try again.', 'ai');
                
            } catch (error) {
                console.error('Error:', error);
                
                // Remove loading message
                chatContainer.removeChild(loadingMessage);
                
                // Add error message
                addMessage('AI', 'üîß I\'m having trouble connecting to my travel database right now. Please check that the backend server is running and try again!', 'ai');
            } finally {
                // Re-enable input
                disableInput(false);
                userInput.focus();
                updateButtonState();
            }
        }

        
        // Initialize
        autoResize(userInput);
        updateButtonState();
        userInput.focus();
    </script>
</body>
</html>